<!DOCTYPE html>
<html>
  <head>
    <title>JavaScript Tools</title>
    <link href="static/css/bootstrap.css" rel="stylesheet">
    <link href="static/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="static/css/formatters-styles-html.css" rel="stylesheet">
    <link href="static/css/formatters-styles-annotated.css" rel="stylesheet">
  </head>
  <body>
    <header class="jumbotron subhead">
      <div class="container">
        <h1>JavaScript Tools</h1>
        <p>Below are some basic tools I put together after not being able to find what I wanted online. I'm hoping to keep on adding more to this list so let me know if you have any suggestions or want to add your own. The code's up on <a href="https://github.com/dangoldin/js-tools">GitHub</a>.
        </p>
      </div>
    </header>

    <hr/>

    <div class="container">

      <div class="tabbable"> <!-- Only required for left/right tabs -->
        <ul class="nav nav-tabs" id="nav-tabs">
          <li class="active">
            <a href="#tab-csv" data-toggle="tab">CSV to Bootstrap Table</a>
          </li>
          <li><a href="#tab-bulk-geocoding" data-toggle="tab">Bulk Geocoding</a></li>
          <li><a href="#tab-bcg-matrix" data-toggle="tab">"BCG Style" Matrix</a></li>
          <li><a href="#tab-sql-data" data-toggle="tab">SQL Data Generation</a></li>
          <li><a href="#tab-sql-schema-comparison" data-toggle="tab">SQL Schema Comparison</a></li>
          <li><a href="#tab-date-generation" data-toggle="tab">Date Generation</a></li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane active" id="tab-csv">
            <div class="row"><!-- Table Generation -->
              <div class="span12">
                <section id="table-generation">
                  <h3>Convert CSV to Bootstrap Table</h3>
                  <p>Enter text into the textarea and then choose the settings to generate the HTML for a Bootstrap table</p>
                  <div class="row">
                    <div class="span4">
                      <form id="id-form-table-conversion">
                        <fieldset>
                          <textarea id="id-textarea" rows="6" class="field span4" placeholder="Paste text here"></textarea>

                          <label class="checkbox">
                            <input type="checkbox" id="id-checkbox" checked> Has Header
                          </label>

                          <label class="radio">
                            <input type="radio" name="radio-delimiter" id="radio-delimiter-comma" value="comma" checked>
                            Comma Delimited
                          </label>
                          <label class="radio">
                            <input type="radio" name="radio-delimiter" id="radio-delimiter-tab" value="tab">
                            Tab Delimited
                          </label>
                          <label class="radio">
                            <input type="radio" name="radio-delimiter" id="radio-delimiter-space" value="space">
                            Space Delimited
                          </label>

                          <button type="submit" class="btn" id="id-submit">Convert!</button>
                        </fieldset>
                      </form>
                    </div>

                    <div class="span8" style="display:none" id="id-table-generation-out">
                      <h4>Generated Table:</h4>
                      <div id="id-table">
                      </div>

                      <h4>Generated Table HTML:</h4>
                      <div id="id-table-code">
                      </div>
                    </div>
                  </div>
                </section>
              </div>
            </div><!-- Table Generation -->
          </div>

          <div class="tab-pane" id="tab-bulk-geocoding">
            <div class="row">
              <div class="span12">
                <section id="bulk-geocoding">
                  <h3>Bulk geocoding</h3>
                  <p>Enter addresses into the textarea below, one per line</p>
                  <div class="row">
                    <div class="span4">
                      <form id="id-form-bulk-geocoding">
                        <fieldset>
                          <textarea id="id-bulk-geocoding-textarea" rows="6" class="field span4" placeholder="Enter addresses here, one per line"></textarea>
                          <a href="#" class="btn" id="id-submit-geocoding">Geocode!</a>
                        </fieldset>
                      </form>
                    </div>

                    <div class="span8">
                      <table class="table" id="geocode-results">
                        <thead>
                          <th>Address</th><th>Lat</th><th>Lng</th>
                        </thead>
                        <tbody>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>

          <div class="tab-pane" id="tab-bcg-matrix">
            <div class="row">
              <div class="span12">
                <section id="bcg-matrix-generation">
                  <h3>Create a BCG Matrix</h3>
                  <p>This helps create a "growth-share" matrix popularzized by BCG. Enter coordinates from -10 to +10 and a label for the plotted value.</p>
                  <div class="row">
                    <div class="span4">
                      <form id="id-form-bcg-matrix">
                        <div class="controls controls-row bcg-row">
                          <input type="text" placeholder="x coord" class="span1 bcg-x-coord" />
                          <input type="text" placeholder="y coord" class="span1 bcg-y-coord" />
                          <input type="text" placeholder="label" class="span1 bcg-label" />
                          <a href="#" class="btn btn-link remove-bcg-row">&times;</a>
                        </div>

                        <div class="controls controls-row">
                          <a href="#" class="btn btn-link add-bcg-row">&plus; Add Row</a>
                        </div>

                        <div class="controls controls-row">
                          <a href="#" class="btn generate-bcg">Generate Matrix</a>
                        </div>
                      </form>
                    </div>
                    <div class="span8">
                      <div id="id-bcg-matrix">
                      </div>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>

          <div class="tab-pane" id="tab-sql-data">
            <div class="row">
              <div class="span12">
                <section id="sql-data-generation">
                  <h3>SQL Data Generation</h3>
                  <p>Use this to create a series of SQL insert statements to populate a table.</p>
                  <div class="row">
                    <div class="span4">
                      <form id="id-form-sql-rows">
                        <div class="controls controls-row">
                          <input type="text" placeholder="table name" class="span2" id="id-sql-rows-table-name" />
                          <input type="text" placeholder="# of rows" class="span2" id="id-sql-rows-num-rows" />
                        </div>
                        <div class="controls controls-row sql-row">
                          <input type="text" placeholder="field name" class="span2 sql-field-name" />
                          <select class="span1 sql-field-type">
                            <option value="date">Date</option>
                            <option value="int">Int</option>
                            <option value="real">Real</option>
                            <option value="string">String</option>
                          </select>
                          <a href="#" class="btn btn-link remove-sql-row">&times;</a>
                        </div>

                        <div class="controls controls-row">
                          <a href="#" class="btn btn-link add-sql-row">&plus; Add Field</a>
                        </div>

                        <div class="controls controls-row">
                          <a href="#" class="btn generate-sql-rows">Generate SQL</a>
                        </div>
                      </form>
                    </div>
                    <div class="span8">
                      <div id="id-sql-rows">
                      </div>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>

          <div class="tab-pane" id="tab-sql-schema-comparison">
            <div class="row">
              <div class="span12">
                <section id="sql-date-generation">
                  <h3>SQL Schema Comparison</h3>
                  <p>Past the result of a schema information query in each tab and get the result. The text areas expect three tab delimited columns: schema name, table name, and column name. The result will do a JSON diff using the awesome <a href="https://github.com/benjamine/jsondiffpatch" target="_blank">jsondiffpatch</a> library.</p>
                  <p>
                  Note: In both MySQL and PostgreSQL you can get the schema information using "select table_schema, table_name, column_name from information_schema.columns" and applying the relevant filters.
                  </p>
                  <div class="row">
                    <div class="span12">
                      <form id="id-form-sql-schema-generation">
                        <div class="controls controls-row">
                          <textarea id="id-sql-schema-1" rows="6" class="field span6" placeholder="Paste a schema dump here"></textarea>
                          <textarea id="id-sql-schema-2" rows="6" class="field span6" placeholder="Paste another schema dump here"></textarea>
                        </div>

                        <div class="controls controls-row">
                          <a href="#" class="btn compare-schema" id="id-compare-schema">Compare!</a>
                        </div>
                      </form>
                    </div>
                </section>
              </div>
            </div>

            <div class="row">
              <div class="span12">
                <div id="compare-schema-results">
                </div>
              </div>
            </div>
          </div>

          <div class="tab-pane" id="tab-date-generation">
            <div class="row">
              <div class="span12">
                <section id="sql-date-generation">
                  <h3>Date Generation</h3>
                  <p>Use this to create a series of dates based on a step size, a start, an end, and a desired format.</p>
                  <div class="row">
                    <div class="span4">
                      <form id="id-form-date-generation">
                        <div class="controls controls-row">
                          <input type="text" placeholder="start date" class="span2" id="id-date-gen-start" />
                          <input type="text" placeholder="end date" class="span2" id="id-date-gen-end" />
                        </div>
                        <div class="controls controls-row">
                          <select class="span2" id="id-date-gen-step-type">
                            <option value="minute">Minute</option>
                            <option value="hour">Hour</option>
                            <option value="day">Day</option>
                            <option value="week">Day</option>
                          </select>
                          <input type="text" placeholder="step value" class="span2" id="id-date-gen-step-value" />
                        </div>
                        <div class="controls controls-row">
                          <input type="text" placeholder="format" class="span2" id="id-date-gen-format" />
                        </div>

                        <div class="controls controls-row">
                          <a href="#" class="btn generate-dates">Generate Dates</a>
                        </div>
                      </form>

                      <div class="span4">
                        Note that the date formats are based on the extremely helpful <a href="https://github.com/phstc/jquery-dateFormat" target="_blank">jquery-dateFormat library</a>. As an example, try "yyyy-MM-dd".
                      </div>
                    </div>
                    <div class="span8">
                      <div id="id-gen-dates">
                      </div>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="container" style="margin-bottom:140px">
      </div>
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

    <script src="static/js/bootstrap.js"></script>
    <script src="static/js/date.js"></script>
    <script src="static/js/jquery-dateFormat.min.js"></script>
    <script src="static/js/jsondiffpatch.js"></script>
    <script src="static/js/jsondiffpatch-formatters.min.js"></script>
    <script src="static/js/diff_match_patch_uncompressed.js"></script>
    <script src="static/js/js-tools-0.1.js"></script>

    <script>
      $('#nav-tabs a').click(function (e) {
        e.preventDefault();
        $(this).tab('show');
        var hash = $(this).attr('href');
        window.location.hash = hash;
      })

      if (window.location.hash) {
        var hash = window.location.hash;

        $('#nav-tabs a').each(function() {
          if ($(this).attr('href') === hash) {
            $(this).tab('show');
          }
        });
      }

      // svg.on('click', function() {
      //   var m = d3.mouse(this);
      //   svg.append("circle")
      //     .attr("cx", m[0])
      //     .attr("cy", m[1])
      //     .attr("r", 2);

      //   var text = svg.append("text")
      //     .attr("x", m[0] + 2)
      //     .attr("y", m[1] - 2)
      //     .text("Hello")
      //     .attr("font-family", "sans-serif")
      //     .attr("font-size", "20px")
      //     .attr("fill", "black");

      //   text.on('click', function() {
      //     console.log('Inner click!');
      //     d3.event.stopPropagation();
      //   });
      // });

      // BCG Matrix
      $('a.add-bcg-row').click(function(){
        $('.bcg-row:last').after(
          '<div class="controls controls-row bcg-row">' +
            '<input type="text" placeholder="x coord" class="span1 bcg-x-coord" />' +
            '<input type="text" placeholder="y coord" class="span1 bcg-y-coord" />' +
            '<input type="text" placeholder="label" class="span1 bcg-label" />' +
            '<a href="#" class="btn btn-link remove-bcg-row">&times;</a>' +
          '</div>');
        return false;
      });

      $('#id-form-bcg-matrix').on('click', 'a.remove-bcg-row', function(){
        if ($('.bcg-row').length > 1) {
          $(this).parents('.bcg-row').remove();
        };
        return false;
      });

      $('.generate-bcg').click(function(){
        var slope = 30,
            intercept = 300,
            points = $('.bcg-row').map(function() {
              var x = $(this).find('.bcg-x-coord').val(),
                  y = $(this).find('.bcg-y-coord').val(),
                  l = $(this).find('.bcg-label').val();
              console.log(x + ' ' + y + ' ' + l);
              return {x: x * slope + intercept, y: -1 * y * slope + intercept, label:l};
            });
        drawBCG(points);
        return false;
      });

      // SQL
      $('a.add-sql-row').click(function(){
        $('.sql-row:last').after(
          '<div class="controls controls-row sql-row">' +
            '<input type="text" placeholder="field name" class="span2 sql-field-name" />' +
            '<select class="span1 sql-field-type">' +
              '<option value="date">Date</option>' +
              '<option value="int">Int</option>' +
              '<option value="real">Real</option>' +
              '<option value="string">String</option>' +
            '</select>' +
            '<a href="#" class="btn btn-link remove-sql-row">&times;</a>' +
          '</div>');
        return false;
      });

      $('#id-form-sql-rows').on('click', 'a.remove-sql-row', function(){
        if ($('.sql-row').length > 1) {
          $(this).parents('.sql-row').remove();
        };
        return false;
      });

      $('.generate-sql-rows').click(function(){
        $('#id-sql-rows').html('');

        var field_info = {},
            field_names = [],
            rows = [],
            table_name = $('#id-sql-rows-table-name').val(),
            num_rows = parseInt($('#id-sql-rows-num-rows').val(),10);
        $('.sql-row').each(function() {
          var field_name = $(this).find('.sql-field-name').val(),
              field_type = $(this).find('.sql-field-type').val();
          field_info[ field_name ] = field_type;
          field_names.push( field_name );
        });
        // console.log(field_info);

        for (var i = 0; i < num_rows; i++) {
          var row = [];
          for (var j = 0; j < field_names.length; j++) {
            var field = field_names[j],
                type  = field_info[field],
                val;
            // console.log(field + '=>' + type);

            switch (type) {
              case 'date':
                var now = new Date();
                var long_time_ago = new Date(now.getTime() - 10000000000);
                val = randomDate(long_time_ago, now).toString('yyyy-MM-dd');
                break;
              case 'int':
                val = randomInt(0, 100);
                break;
              case 'real':
                val = randomReal(0, 100);
                break;
              case 'string':
                val = randomString(10);
                break;
            }
            row.push("'" + val + "'");
          }
          rows.push(row);
        }
        // console.log(rows);

        var sql = '';
        for (var i = 0; i < rows.length; i++) {
          var row = rows[i],
              row_sql = 'INSERT INTO ' + table_name + ' (' + field_names.join(', ') + ') VALUES (' + row.join(', ') + ');<br/>';
              sql += row_sql;
        }
        $('#id-sql-rows').html(sql);

        return false;
      });

      $('.generate-dates').click(function() {
        $('#id-gen-dates').html('');

        var start = new Date($('#id-date-gen-start').val()),
            end   = new Date($('#id-date-gen-end').val()),
            step_type = $('#id-date-gen-step-type').val(),
            step_val  = $('#id-date-gen-step-value').val(),
            date_fmt  = $('#id-date-gen-format').val();

        start.setTime( start.getTime() + start.getTimezoneOffset() * 60 * 1000 );
        end.setTime( end.getTime() + end.getTimezoneOffset() * 60 * 1000 );

        switch (step_type) {
          case 'minute':
            step_val *= 60 * 1000;
            break;
          case 'hour':
            step_val *= 60 * 60 * 1000;
            break;
          case 'day':
            step_val *= 24 * 60 * 60 * 1000;
            break;
          case 'week':
            step_val *= 7 * 24 * 60 * 60 * 1000;
            break;
        }

        var outHTML = '';
        while (start < end) {
          outHTML += $.format.date(start, date_fmt) + "<br/>";
          start = new Date( start.getTime() + step_val );
        }
        $('#id-gen-dates').html(outHTML);
      });

      // Bulk geocoding
      var geocoder = new google.maps.Geocoder();

      $('#id-submit-geocoding').click(function() {
        var addrs = $('#id-bulk-geocoding-textarea').val().split("\n");
        console.log(addrs);

        for (var i = 0; i < addrs.length; i++) {
          (function() {
            var addr = addrs[i];
            geocoder.geocode( { 'address': addr}, function(results, status) {
              if (status == google.maps.GeocoderStatus.OK) {
                var
                  location = results[0].geometry.location;
                  rowHTML = '<tr><td>' + addr + '</td><td>' + location.lat() + '</td><td>' + location.lng() + '</td></tr>';

                $('#geocode-results > tbody').append(rowHTML);
              } else {
                console.log("Error looking up address" + addr);
                alert("Geocode was not successful for the following reason: " + status);
              }
            });
          })();
        };

        return false;
      });

      $('#id-compare-schema').click(function() {
        var getOrCreate = function(obj, key) {
          if (!(key in obj)) {
            obj[key] = {};
          }
          return obj[key];
        };

        var loadSchema = function(str) {
          var s = {};
          str.split("\n").forEach(function(el, idx) {
            // For now assume the order is schema, table, column
            var vals = el.split("\t"),
                schema = vals[0],
                table  = vals[1],
                column = vals[2];

            var sO = getOrCreate(s, schema);
            var tO = getOrCreate(sO, table);
            tO[column] = true; // Just set to a boolean
          });
          return s;
        };

        var schema1 = $('#id-sql-schema-1').val(),
            schema2 = $('#id-sql-schema-2').val();
        var s1 = loadSchema(schema1);
        var s2 = loadSchema(schema2);
        var diffs = jsondiffpatch.diff(s1, s2);

        // Show the diffs and hide the same values
        jsondiffpatch.formatters.html.hideUnchanged();
        $('#compare-schema-results').html( jsondiffpatch.formatters.html.format(diffs, s1) );

        return false;
      });

    </script>
  </body>
</html>